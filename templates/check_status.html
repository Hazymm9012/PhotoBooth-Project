<!-- /payment-status -->
<h2>Processing your payment...</h2>
<p id="status">Waiting for confirmation...</p>

<script>
const ref = new URLSearchParams(location.search).get("reference");

function pollStatus() {
  fetch(`/check-status?reference=${ref}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("status").innerText = "Status: " + data.status;
      if (data.status === 'succeeded') {
        window.location.href = "/generate_qr_code?reference=" + ref;
      } else if (data.status === 'failed') {
        window.location.href = "/fail";
      } else {
        setTimeout(pollStatus, 2000);
      }
    });
}

pollStatus();
</script>
